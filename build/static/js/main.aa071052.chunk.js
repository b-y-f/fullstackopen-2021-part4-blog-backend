(this["webpackJsonpbloglist-frontend"]=this["webpackJsonpbloglist-frontend"]||[]).push([[0],{64:function(e,t,n){"use strict";n.r(t);var r=n(1),c=n.n(r),a=n(18),s=n.n(a),i=n(2),u=n.n(i),o=n(5),l=n(10),d=n(0),j=function(){var e=Object(l.c)((function(e){return e.message}));return e?Object(d.jsx)("div",{style:{border:"solid",padding:10,borderWidth:1},children:e}):Object(d.jsx)(d.Fragment,{})},b=n(24),h=n(14),f=n.n(h),p="/api/blogs",O=null,v={getAll:function(){var e=Object(o.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.get(p);case 2:return t=e.sent,e.abrupt("return",t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),setToken:function(e){O="bearer ".concat(e)},create:function(){var e=Object(o.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:O}},e.next=3,f.a.post(p,t,n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),update:function(){var e=Object(o.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.put("".concat(p,"/").concat(t),n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),remove:function(){var e=Object(o.a)(u.a.mark((function e(t){var n,r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:O}},e.next=3,f.a.delete("".concat(p,"/").concat(t),n);case 3:return r=e.sent,e.abrupt("return",r.data);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),addComment:function(){var e=Object(o.a)(u.a.mark((function e(t,n){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("".concat(p,"/").concat(t,"/comments"),n);case 2:return r=e.sent,e.abrupt("return",r.data);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},x=function(){return function(){var e=Object(o.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.getAll();case 2:n=e.sent,t({type:"ALL",blogs:n});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},g=n(12);function m(e){var t=e.handleLogin,n=Object(r.useState)(""),c=Object(g.a)(n,2),a=c[0],s=c[1],i=Object(r.useState)(""),u=Object(g.a)(i,2),o=u[0],l=u[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Log in to application"}),Object(d.jsxs)("form",{onSubmit:function(e){e.preventDefault(),t(a,o),s(""),l("")},children:[Object(d.jsxs)("div",{children:["username",Object(d.jsx)("input",{id:"username",type:"text",value:a,name:"Username",onChange:function(e){var t=e.target;return s(t.value)}})]}),Object(d.jsxs)("div",{children:["password",Object(d.jsx)("input",{id:"password",type:"password",value:o,name:"Password",onChange:function(e){var t=e.target;return l(t.value)}})]}),Object(d.jsx)("button",{id:"login-button",type:"submit",children:"login"})]})]})}var w,y={login:function(){var e=Object(o.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a.post("/api/login",t);case 2:return n=e.sent,e.abrupt("return",n.data);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},k=function(e,t){return function(){var n=Object(o.a)(u.a.mark((function n(r){var c;return u.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,y.login({username:e,password:t});case 2:return c=n.sent,window.localStorage.setItem("loggedUser",JSON.stringify(c)),v.setToken(c.token),n.abrupt("return",r({type:"LOGIN",user:c}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}()},S=n(13);function E(e){var t=e.handleLogout,n=e.user;return Object(d.jsxs)("div",{style:{backgroundColor:"#00CED1"},children:[Object(d.jsx)("span",{children:Object(d.jsx)(S.b,{to:"/",children:"blogs"})}),"\xa0 \xa0",Object(d.jsx)("span",{children:Object(d.jsx)(S.b,{to:"/users",children:"users"})}),"\xa0 \xa0 ",n.name," logged in \xa0 \xa0",Object(d.jsx)("button",{onClick:t,children:" Log out"})]})}var L=function(e,t){return function(n){n({type:"SET_MESSAGE",message:e}),clearTimeout(w),w=setTimeout((function(){n({type:"SET_MESSAGE",message:null})}),1e3*t)}},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_MESSAGE":return t.message;default:return e}};function N(e){var t=e.blog,n=Object(l.b)(),c=Object(r.useState)(""),a=Object(g.a)(c,2),s=a[0],i=a[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{className:"blogTitle",children:t.title}),Object(d.jsxs)("div",{className:"blogDetail",children:[Object(d.jsx)("div",{className:"blogUrl",children:t.url}),Object(d.jsxs)("div",{className:"blogLikes",children:["likes : ",t.likes,Object(d.jsx)("button",{className:"likeButton",onClick:function(){var e;n((e=t,function(){var t=Object(o.a)(u.a.mark((function t(n){var r,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Object(b.a)(Object(b.a)({},e),{},{likes:e.likes+1}),t.next=3,v.update(e.id,r);case 3:c=t.sent,n({type:"LIKE_ADD_ONE",blog:c});case 5:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),n(L("You liked it!",5))},children:"like"})]}),Object(d.jsxs)("div",{children:["added by ",t.author]}),Object(d.jsx)("h2",{children:"Comments"}),Object(d.jsxs)("div",{className:"addComment",children:[Object(d.jsx)("input",{value:s,onChange:function(e){var t=e.target;return i(t.value)}}),Object(d.jsx)("button",{onClick:function(){var e,r;n((e=t.id,r=s,function(){var t=Object(o.a)(u.a.mark((function t(n){var c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.addComment(e,{content:r});case 2:c=t.sent,n({type:"ADD_COMMENT",blog:c,id:e});case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),i("")},children:"add"})]}),Object(d.jsx)("ul",{children:t.comments.map((function(e){return Object(d.jsxs)("li",{children:[Object(d.jsx)("p",{children:e.content})," at ",e.date]},e._id)}))})]})]},t.id)}var A=n(4),T=function(e){var t=Object(r.useState)(!1),n=Object(g.a)(t,2),c=n[0],a=n[1],s={display:c?"none":""},i={display:c?"":"none"},u=function(){a(!c)};return Object(d.jsxs)("div",{children:[Object(d.jsx)("div",{style:s,children:Object(d.jsx)("button",{onClick:u,children:e.buttonLabel})}),Object(d.jsxs)("div",{style:i,children:[e.children,Object(d.jsx)("button",{onClick:u,children:"cancel"})]})]})},D=function(){var e=Object(l.b)(),t=Object(r.useState)(""),n=Object(g.a)(t,2),c=n[0],a=n[1],s=Object(r.useState)(""),i=Object(g.a)(s,2),j=i[0],b=i[1],h=Object(r.useState)(""),f=Object(g.a)(h,2),p=f[0],O=f[1];return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Create new"}),Object(d.jsxs)("form",{onSubmit:function(t){var n;t.preventDefault(),e((n={title:c,author:j,url:p},function(){var e=Object(o.a)(u.a.mark((function e(t){var r;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.create(n);case 2:r=e.sent,t({type:"NEW",data:{blog:r}});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(){e(x()),e(L("added!",5)),b(""),a(""),O("")})).catch((function(){return alert("fail")}))},children:[Object(d.jsxs)("div",{children:["title:",Object(d.jsx)("input",{id:"title",type:"text",value:c,name:"Title",onChange:function(e){var t=e.target;return a(t.value)}})]}),Object(d.jsxs)("div",{children:["author:",Object(d.jsx)("input",{id:"author",type:"text",value:j,name:"Author",onChange:function(e){var t=e.target;return b(t.value)}})]}),Object(d.jsxs)("div",{children:["url:",Object(d.jsx)("input",{id:"url",type:"text",value:p,name:"Url",onChange:function(e){var t=e.target;return O(t.value)}})]}),Object(d.jsx)("button",{type:"submit",children:"add"})]})]})};function M(e){var t=e.blogs,n=e.can,r=e.user;if(!t)return null;var c={paddingTop:10,paddingLeft:2,border:"solid",borderWidth:1,marginBottom:5};return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h2",{children:n?"Your blogs":r.name}),Object(d.jsx)("h3",{children:"Blog list"}),n?Object(d.jsx)(T,{buttonLabel:"create new blog",children:Object(d.jsx)(D,{})}):null,Object(d.jsx)("div",{children:t.map((function(e){return Object(d.jsx)("div",{style:c,children:Object(d.jsx)(S.b,{to:"/blogs/".concat(e.id),children:e.title})},e.id)}))})]})}function _(e){var t=e.blogs,n=new Map;t.forEach((function(e){var t=e.user.username;void 0!==n.get(t)?n.set(t,n.get(t)+1):n.set(t,1)}));var r=Array.from(n);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h2",{children:"Users"}),Object(d.jsx)("br",{}),Object(d.jsxs)("table",{children:[Object(d.jsx)("thead",{children:Object(d.jsxs)("tr",{children:[Object(d.jsx)("th",{}),Object(d.jsx)("th",{children:"blogs count"})]})}),Object(d.jsx)("tbody",{children:r.map((function(e){return Object(d.jsxs)("tr",{children:[Object(d.jsx)("td",{children:Object(d.jsx)(S.b,{to:"/users/".concat((n=e[0],t.find((function(e){return e.user.username===n})).user.id)),children:e[0]})}),Object(d.jsx)("td",{children:e[1]})]},e[0]);var n}))})]})]})}var I=function(){var e=Object(l.b)(),t=Object(l.c)((function(e){return e.blogs})).sort((function(e,t){return e.likes>t.likes?-1:e.likes<t.likes?1:0})),n=Object(l.c)((function(e){return e.user}));Object(r.useEffect)((function(){e(x());var t=window.localStorage.getItem("loggedUser");t&&e(function(e){var t=JSON.parse(e);return v.setToken(t.token),{type:"LOGIN",user:t}}(t))}),[e]);var c=function(){var t=Object(o.a)(u.a.mark((function t(n,r){return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:try{e(k(n,r)),e(x())}catch(c){console.log("login err")}case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),a=function(){window.localStorage.clear(),window.location.reload()},s=Object(A.g)("/blogs/:id"),i=s?t.find((function(e){return e.id===s.params.id})):null,b=Object(A.g)("/users/:id"),h=b?t.filter((function(e){return b.params.id===e.user.id})):null,f=n?t.filter((function(e){return n.id===e.user.id})):null;return Object(d.jsxs)(d.Fragment,{children:[n?Object(d.jsx)(E,{user:n,handleLogout:a}):null,Object(d.jsx)(j,{}),Object(d.jsxs)(A.d,{children:[Object(d.jsx)(A.b,{path:"/users/:id",children:n?Object(d.jsx)(M,{blogs:h,can:function(e,t){if(e&&t)return e.params.id===t.id}(b,n),user:n}):Object(d.jsx)(A.a,{to:"/"})}),Object(d.jsx)(A.b,{path:"/users",children:n?Object(d.jsx)(_,{blogs:t}):Object(d.jsx)(A.a,{to:"/"})}),Object(d.jsx)(A.b,{path:"/blogs/:id",children:n?Object(d.jsx)(N,{blog:i}):Object(d.jsx)(A.a,{to:"/"})}),Object(d.jsx)(A.b,{path:"/",children:n?Object(d.jsx)(M,{blogs:f,can:!0,user:n}):Object(d.jsx)(m,{handleLogin:c,handleLogout:a})})]})]})},G=n(17),U=n(33),W=n(34),B=Object(G.combineReducers)({message:C,blogs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"ALL":return t.blogs;case"NEW":return e.concat(t.data.blog);case"LIKE_ADD_ONE":var n=e.filter((function(e){return e.id!==t.blog.id}));return n.concat(t.blog);case"DELETE":return e.filter((function(e){return e.id!==t.data.id}));case"ADD_COMMENT":var r=e.filter((function(e){return e.id!==t.id}));return r.concat(t.blog);default:return e}},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOGIN":return t.user;default:return e}}}),F=Object(G.createStore)(B,Object(W.composeWithDevTools)(Object(G.applyMiddleware)(U.a)));s.a.render(Object(d.jsx)(c.a.StrictMode,{children:Object(d.jsx)(l.a,{store:F,children:Object(d.jsx)(S.a,{children:Object(d.jsx)(I,{})})})}),document.getElementById("root"))}},[[64,1,2]]]);
//# sourceMappingURL=main.aa071052.chunk.js.map